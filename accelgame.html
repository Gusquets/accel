<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>오토바이 기어 변속 게임</title>
</head>
<body>
<h1>오토바이 기어 변속 게임</h1>
<p>Shift 키를 누르고 있으면 속도가 올라가고 때면 속도가 내려갑니다.</p>
<p>X 키를 누른 상태에서 Z 키를 누르면 기어가 내려갑니다.</p>
<p>X 키를 누른 상태에서 C 키를 누르면 기어가 올라갑니다.</p>
<p>현재 속도: <span id="speed">0</span> km/h</p>
<p>현재 RPM: <span id="rpm">0</span></p>
<p>현재 기어: <span id="gear">N</span></p>
<p id="message"></p>
<!-- <button onclick="restartGame()">다시 시작</button> -->
<p>100km/h 돌파까지 걸린 시간: <span id="time">-</span></p>


<script>
let speed = 0;
let rpm = 0;
let gear = 'N';
let isShiftPressed = false;
let isXPressed = false;
let isGearChanging = false;
let isStarted = false;
let isFinished = false;
let isFirst = true;
let startTime;
let endTime;



setInterval(function() {
    if (isShiftPressed) {
        speed += getSpeedIncrement(gear); // 속도를 기어에 따라 증가시킴
        if (speed >= 100 && isFinished == false) {
            endTime = new Date().getTime();
            let elapsedTime = (endTime - startTime) / 1000;
            elapsedTime = Math.round(elapsedTime * 1000) / 1000; // 소수 셋째 자리에서 반올림
            document.getElementById("time").innerHTML = elapsedTime;
            isFinished = true;
        }
    } else {
        if (gear === 'N') {
            decelerateSlowly();
        } else {
            decelerateQuickly();
        }
    }
    updateSpeed();
    updateRPM();
}, 100); // 0.2초마다 실행

document.addEventListener('keydown', function(event) {
    if (isGearChanging) return; // 변속 중일 때는 키 입력 무시
    if (event.key === 'Shift') {
        isShiftPressed = true;
        if(isFirst == true) {
            startTime = new Date().getTime();
            isFirst = false;
        }
    } else if (event.key === 'x') {
        isXPressed = true;
    } else if (event.key === 'z' && isXPressed) {
        changeGear('down');
    } else if (event.key === 'c' && isXPressed) {
        changeGear('up');
    }
});

document.addEventListener('keyup', function(event) {
    if (event.key === 'Shift') {
        isShiftPressed = false;
    } else if (event.key === 'x') {
        isXPressed = false;
    }
});

function decelerateSlowly() {
    if (speed > 0) {
        speed -= getSpeedIncrement(gear); // 기어가 N일 때 천천히 속도를 감소
    }
}

function decelerateQuickly() {
    if (speed > 0) {
        speed -= getSpeedIncrement(gear); // 기어가 N이 아닐 때 빠르게 속도를 감소
    }
}

function changeGear(direction) {
    if (direction === 'up') {
        if (gear === 'N') {
            gear = '1';
        } else if (gear === '1') {
            gear = '2';
        } else if (gear === '2') {
            gear = '3';
        } else if (gear === '3') {
            gear = '4';
        } else if (gear === '4') {
            gear = '5';
        } // 이하 기어 변경 로직 추가
    } else if (direction === 'down') {
        if (gear === '1') {
            gear = 'N';
        } else if (gear === '2') {
            gear = '1';
        } else if (gear === '3') {
            gear = '2';
        } else if (gear === '4') {
            gear = '3';
        } else if (gear === '5') {
            gear = '4';
        } // 이하 기어 변경 로직 추가
    }
    isGearChanging = true; // 변속 중으로 설정
    checkGearChange(); // 변속 체크 함수 호출
    updateGear();
    isGearChanging = false; 
}

function checkGearChange() {
    // 현재 기어와 속도에 따라 변속 가능 여부 체크
    if ((gear === 'N' && speed <= 20) ||
        (gear === '1' && speed >= 10 && speed <= 30) ||
        (gear === '2' && speed >= 20 && speed <= 50) ||
        (gear === '3' && speed >= 30 && speed <= 70) ||
        (gear === '4' && speed >= 40 && speed <= 90) ||
        (gear === '5' && speed >= 50)) {
        document.getElementById("message").innerText = "기어 변속 성공!";
    } else {
        document.getElementById("message").innerText = "기어 변속 실패!";
        // clearInterval(intervalId); // 게임 멈춤
        // document.querySelector("button").disabled = false;
    }
    setTimeout(function() {
        isGearChanging = false; // 변속 완료 후 상태를 변속 중이 아닌 상태로 설정
        document.getElementById("message").innerText = ""; // 메시지 초기화
    }, 1000); // 1초 후 실행
}

function restartGame() {
    speed = 0;
    gear = 'N';
    updateSpeed();
    updateGear();
    document.getElementById("message").innerText = "";
    // document.querySelector("button").disabled = true; // 다시 시작 버튼 비활성화
    startGame(); // 게임 재시작
}

function updateSpeed() {
    document.getElementById("speed").innerText = speed;
}

function updateRPM() {
    rpm = speed * 30; // 속도에 따른 RPM 계산
    document.getElementById("rpm").innerText = rpm;
}

function updateGear() {
    document.getElementById("gear").innerText = gear;
}

function updateElapsedtime() {
    if (startTime !== null && speed >= 100) {
        const currentTime = new Date();
        const elapsedTime = (currentTime - startTime) / 1000; // 경과 시간(초)
        document.getElementById("time").innerText = elapsedTime.toFixed(1) + " 초";
    }
}

function getSpeedIncrement(gear) {
    // 기어별 속도 변화량을 반환
    if (gear === 'N') {
        return 1;
    } else if (gear === '1') {
        return 2;
    } else if (gear === '2') {
        return 4;
    } else if (gear === '3') {
        return 6;
    } else if (gear === '4') {
        return 8;
    } else if (gear === '5') {
        return 10;
    }
}

</script>
</body>
</html>
